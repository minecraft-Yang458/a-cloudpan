<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>我的云盘</title>
</head>
<body>
  <h2>我的云盘</h2>

  <h3>上传文件</h3>
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">上传</button>
  <p id="uploadStatus"></p>

  <h3>下载文件</h3>
  <input type="text" id="fileNameInput" placeholder="输入文件名">
  <button onclick="downloadFile()">下载</button>
  <p id="downloadStatus"></p>

  <h3>文件列表</h3>
  <button onclick="listFiles()">刷新列表</button>
  <ul id="fileList"></ul>

  <script>
    const API_BASE = '/api'; // 对应 Workers 路由

    async function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        document.getElementById('uploadStatus').innerText = '请选择文件';
        return;
      }
      const form = new FormData();
      form.append('file', file);

      try {
        const res = await fetch(`${API_BASE}/upload`, { method: 'POST', body: form });
        const data = await res.json();
        document.getElementById('uploadStatus').innerText = data.message || '上传完成';
      } catch (e) {
        document.getElementById('uploadStatus').innerText = '上传失败: ' + e;
      }
    }

    async function downloadFile() {
      const name = document.getElementById('fileNameInput').value.trim();
      if (!name) {
        document.getElementById('downloadStatus').innerText = '请输入文件名';
        return;
      }
      try {
        const res = await fetch(`${API_BASE}/download?filename=${encodeURIComponent(name)}`);
        if (!res.ok) throw new Error('下载失败');
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = name;
        a.click();
        URL.revokeObjectURL(url);
        document.getElementById('downloadStatus').innerText = '下载成功';
      } catch (e) {
        document.getElementById('downloadStatus').innerText = e;
      }
    }

    async function listFiles() {
      try {
        const res = await fetch(`${API_BASE}/list`);
        const files = await res.json();
        const ul = document.getElementById('fileList');
        ul.innerHTML = '';
        files.forEach(f => {
          const li = document.createElement('li');
          li.textContent = f;
          ul.appendChild(li);
        });
      } catch (e) {
        alert('获取文件列表失败: ' + e);
      }
    }
  </script>
</body>
</html>
